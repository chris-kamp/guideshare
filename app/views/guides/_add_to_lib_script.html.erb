<script>
  <% if !user_signed_in? %>
    // Anonymous IIFE which executes on page load if user is not signed in
    (() => {
      // Abort if add to library button not found on page
      if (!document.getElementById('add-to-lib')) {
        return;
      }
      // Get a reference to the Add to Library button
      addToLib = document.getElementById('add-to-lib');
      // Change its type to "button" to prevent it from submitting the hidden form generated by button_to
      addToLib.setAttribute("type", "button");
      // Instead, add an event listener that sends user to the sign-in page after setting the devise post-sign-in 
      // redirect location to the current page
      addToLib.addEventListener("click", () => {
          <% session["user_return_to"] = request.url %>
          location = "<%= new_user_session_path %>"
      });
    })();
  <% end %>
</script>